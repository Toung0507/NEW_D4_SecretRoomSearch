import{j as e,P as d,n as te,r as o,e as ne,b as y}from"./index-ClSJhwQF.js";import{G as S}from"./GroupCard-BzlShs6V.js";const P=({search:r,handleInputChange:s,handleSearch:l,handleReset:c,area:n,difficultys:m,propertys:_,maxPeople:E})=>e.jsxs("div",{className:"col-md-3 pe-lg-6 pe-md-3",children:[e.jsxs("form",{className:"p-4 bg-white",onSubmit:a=>l(a),children:[e.jsxs("div",{className:"order",children:[e.jsx("p",{className:"h5 pb-3 fw-bold",children:"排序條件"}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"form-check form-check-inline",children:[e.jsx("input",{onChange:s,className:"form-check-input",defaultChecked:!0,type:"radio",name:"order",id:"order_price",value:"order_price"}),e.jsx("label",{className:"form-check-label",htmlFor:"order_price",children:"價格(由高到低)"})]}),e.jsxs("div",{className:"form-check form-check-inline",children:[e.jsx("input",{onChange:s,className:"form-check-input",type:"radio",name:"order",id:"order_popularity",value:"order_popularity"}),e.jsx("label",{className:"form-check-label",htmlFor:"order_popularity",children:"人氣"})]})]})]}),e.jsxs("div",{className:"search",children:[e.jsx("p",{className:"h5 pb-3 fw-bold",children:"遊戲名稱"}),e.jsxs("div",{className:"search-all-group mb-6",children:[e.jsx("label",{htmlFor:"game_name",className:"pb-1",children:"搜尋"}),e.jsx("div",{className:"input-group search-group border rounded-1 border-primary-black",children:e.jsx("input",{onChange:s,type:"text",className:"form-control border-0 search-input",placeholder:"搜尋關鍵字","aria-label":"Search",name:"game_name",id:"game_name",value:r.game_name})})]})]}),e.jsx("div",{className:"d-flex w-100",children:e.jsxs("div",{className:"row w-100 row1 flex-md-column",children:[e.jsx("div",{className:"col-6 col-md-12 col1",children:e.jsxs("div",{className:"area",children:[e.jsx("p",{className:"h5 pb-4 fw-bold",children:"遊戲地區"}),e.jsxs("select",{onChange:s,className:"form-select d-md-none mb-md-6 mb-3 border rounded-1 border-primary-black","aria-label":"選擇遊玩地區",name:"area",value:r.area.length>0?r.area[0]:"",children:[e.jsx("option",{value:"",children:"請選擇遊玩地區"}),n.map((a,p)=>e.jsx("option",{value:a.area_name,children:a.area_name},p))]}),e.jsxs("div",{className:"row m-0 mb-6 d-none d-md-flex",children:[e.jsx("div",{className:"col-md-6 mx-0 p-0 w-auto",children:n.slice(0,n.length/2).map((a,p)=>e.jsxs("div",{className:"form-check mb-4 me-6",children:[e.jsx("input",{onChange:s,className:"form-check-input",type:"checkbox",value:a.area_name,id:a.area_value,name:"area",checked:r.area.includes(a.area_name)}),e.jsx("label",{className:"form-check-label text-nowrap",htmlFor:a.area_value,children:a.area_name})]},p))}),e.jsx("div",{className:"col-md-6 m-0 p-0",children:n.slice(n.length/2).map((a,p)=>e.jsxs("div",{className:"form-check mb-4",children:[e.jsx("input",{onChange:s,className:"form-check-input",type:"checkbox",value:a.area_name,id:a.area_value,name:"area",checked:r.area.includes(a.area_name)}),e.jsx("label",{className:"form-check-label text-nowrap",htmlFor:a.area_value,children:a.area_name})]},p))})]})]})}),e.jsx("div",{className:"col-6 col-md-12 col1",children:e.jsxs("div",{className:"people",children:[e.jsx("p",{className:"h5 pb-4 fw-bold",children:"遊玩人數"}),e.jsxs("select",{onChange:s,className:"form-select mb-md-6 mb-3 border rounded-1 border-primary-black","aria-label":"選擇遊玩人數",name:"game_people",value:r.game_people,children:[e.jsx("option",{value:"",children:"請選擇遊玩人數"}),Array.from({length:Number(E)}).map((a,p)=>e.jsxs("option",{value:p+1,children:[p+1,"人"]},p))]})]})})]})}),e.jsx("div",{className:"d-flex w-100",children:e.jsxs("div",{className:"row w-100 row1 flex-md-column",children:[e.jsx("div",{className:"col-6 col-md-12 col1",children:e.jsxs("div",{className:"difficulty",children:[e.jsx("p",{className:"h5 pb-4 fw-bold",children:"難度"}),e.jsxs("select",{onChange:s,className:"form-select d-md-none mb-md-6 mb-3 border rounded-1 border-primary-black","aria-label":"選擇難度",name:"difficulty",value:r.difficulty.length>0?r.difficulty[0]:"",children:[e.jsx("option",{value:"",children:"請選擇難度"}),m.map(a=>e.jsx("option",{value:a.difficulty_id,children:a.difficulty_name},a.difficulty_id))]}),e.jsxs("div",{className:"row m-0 mb-6 d-none d-md-flex",children:[e.jsx("div",{className:"col-md-6 mx-0 p-0 w-auto",children:m.slice(0,Math.round(m.length/2)).map(a=>e.jsxs("div",{className:"form-check mb-4 me-6",children:[e.jsx("input",{onChange:s,className:"form-check-input",type:"checkbox",value:a.difficulty_id,id:a.difficulty_id,name:"difficulty",checked:r.difficulty.includes(String(a.difficulty_id))}),e.jsx("label",{className:"form-check-label text-nowrap",htmlFor:a.difficulty_id,children:a.difficulty_name})]},a.difficulty_id))}),e.jsx("div",{className:"col-md-6 m-0 p-0",children:m.slice(Math.round(m.length/2)).map(a=>e.jsxs("div",{className:"form-check mb-4",children:[e.jsx("input",{onChange:s,className:"form-check-input",type:"checkbox",value:a.difficulty_id,id:a.difficulty_id,name:"difficulty",checked:r.difficulty.includes(String(a.difficulty_id))}),e.jsx("label",{className:"form-check-label text-nowrap",htmlFor:a.difficulty_id,children:a.difficulty_name})]},a.difficulty_id))})]})]})}),e.jsx("div",{className:"col-6 col-md-12 col1",children:e.jsxs("div",{className:"topic",children:[e.jsx("p",{className:"h5 pb-4 fw-bold",children:"主題"}),e.jsxs("select",{onChange:s,className:"form-select d-md-none mb-md-6 mb-3 border rounded-1 border-primary-black","aria-label":"選擇主題類別",name:"property",value:r.property.length>0?r.property[0]:"",children:[e.jsx("option",{value:"",children:"請選擇主題類別"}),_.map(a=>e.jsx("option",{value:a.property_id,children:a.property_name},a.property_id))]}),e.jsxs("div",{className:"row m-0 mb-6 d-none d-md-flex",children:[e.jsx("div",{className:"col-md-6 mx-0 p-0 w-auto",children:_.slice(0,_.length/2).map(a=>e.jsxs("div",{className:"form-check mb-4 me-6",children:[e.jsx("input",{onChange:s,className:"form-check-input",type:"checkbox",value:a.property_id,id:a.property_name,name:"property",checked:r.property.includes(String(a.property_id))}),e.jsx("label",{className:"form-check-label text-nowrap",htmlFor:a.property_name,children:a.property_name})]},a.property_id))}),e.jsx("div",{className:"col-md-6 m-0 p-0",children:_.slice(_.length/2).map(a=>e.jsxs("div",{className:"form-check mb-4",children:[e.jsx("input",{onChange:s,className:"form-check-input",type:"checkbox",value:a.property_id,id:a.property_name,name:"property",checked:r.property.includes(String(a.property_id))}),e.jsx("label",{className:"form-check-label text-nowrap",htmlFor:a.property_name,children:a.property_name})]},a.property_id))})]})]})})]})}),e.jsx("div",{className:"text-center",children:e.jsx("button",{className:"btn btn-secondary-60 link-white rounded-2 w-100",children:"搜尋"})})]}),e.jsx("div",{className:"px-4",children:e.jsx("button",{onClick:c,className:"btn w-100 reset_button border-0 text-primary-black fw-bold text-sm-center text-end",children:"重置"})})]});P.propTypes={search:d.object.isRequired,handleInputChange:d.func.isRequired,handleSearch:d.func.isRequired,handleReset:d.func.isRequired,area:d.array.isRequired,difficultys:d.array.isRequired,propertys:d.array.isRequired,maxPeople:d.number.isRequired};const M=({searchGames:r,isHaveResultGames:s,group:l})=>e.jsxs("div",{className:"search my-5 my-md-10",children:[e.jsx("div",{className:"title-container w-100 d-flex justify-content-center align-items-center",children:e.jsx("h3",{className:"text-center mb-12 recommendation-title fw-bold fs-sm-h3 fs-h6",children:"依據您的搜尋/排序結果如下"})}),e.jsxs("div",{className:"row m-0",children:[e.jsx("div",{className:"row m-0",children:s?r.filter(({group:c})=>new Date(c.group_active_date)>=new Date).map(({game:c,group:n,user:m})=>e.jsx(S,{game:c,group:n,user:m},n.game_id)):e.jsx("div",{className:"text-center",children:e.jsxs("p",{className:"h4",children:["您輸入的條件未查詢到相符合結果",e.jsx("br",{}),"請放寬條件重新查詢"]})})}),e.jsxs("div",{className:"row m-0 mt-3",children:[e.jsx("div",{className:"title-container w-100 d-flex justify-content-center align-items-center",children:e.jsx("h3",{className:"text-center mb-12 recommendation-title fw-bold fs-sm-h3 fs-h6",children:"相關推薦"})}),l.slice(0,4).filter(({group:c})=>new Date(c.group_active_date)>=new Date).filter(({game:c})=>!r.some(n=>n.game.game_id===c.game_id)).map(({game:c,group:n,user:m})=>e.jsx(S,{game:c,group:n,user:m},n.game_id))]})]})]});M.propTypes={searchGames:d.array.isRequired,isHaveResultGames:d.bool.isRequired,group:d.array.isRequired};const $=({group:r,isAllRecommendDisplay:s,handleSeeRecommendMore:l})=>e.jsxs("div",{className:"recommend my-5 my-md-10",children:[e.jsx("div",{className:"title-container w-100 d-flex justify-content-center align-items-center",children:e.jsx("h3",{className:"text-center mb-12 recommendation-title fw-bold fs-sm-h3 fs-h6",children:"揪團專區"})}),e.jsxs("div",{className:"row m-0",children:[s?r.map(({game:c,group:n,user:m})=>e.jsx(S,{game:c,group:n,user:m},n.group_id)):r.slice(0,8).map(({game:c,group:n,user:m})=>e.jsx(S,{game:c,group:n,user:m},n.group_id)),e.jsxs("div",{className:"d-flex justify-content-end mt-3 mt-md-0",children:[e.jsx("button",{className:`btn btn-secondary-60 text-white  ${s?"d-none":""}`,onClick:()=>l(),children:"查看更多揪團"}),e.jsx("button",{className:`btn btn-secondary-60 text-white  ${s?"":"d-none"}`,onClick:()=>l(),children:"顯示較少揪團"})]})]})]});$.propTypes={group:d.array.isRequired,isAllRecommendDisplay:d.bool.isRequired,handleSeeRecommendMore:d.func.isRequired};const O=({message:r,onRetry:s})=>e.jsxs("div",{className:"alert alert-danger d-flex align-items-center justify-content-between",role:"alert",children:[e.jsxs("div",{children:[e.jsx("i",{className:"bi bi-exclamation-triangle-fill me-2"}),r||"發生錯誤，請稍後再試"]}),s&&e.jsx("button",{className:"btn btn-sm btn-outline-danger",onClick:s,children:"重試"})]});O.propTypes={message:d.string,onRetry:d.func};const I={order:"order_price",game_name:"",area:[],game_people:"",difficulty:[],property:[]},b={SET_FIELD:"SET_FIELD",TOGGLE_ARRAY_FIELD:"TOGGLE_ARRAY_FIELD",RESET:"RESET"},ie=(r,s)=>{switch(s.type){case b.SET_FIELD:return{...r,[s.field]:s.value};case b.TOGGLE_ARRAY_FIELD:{const l=r[s.field],c=s.value,n=l.includes(c);return{...r,[s.field]:n?l.filter(m=>m!==c):[...l,c]}}case b.RESET:return I;default:return r}},w="https://new-json.onrender.com",oe=[{area_name:"台北市",area_value:"taipei"},{area_name:"基隆市",area_value:"keelung"},{area_name:"新竹市",area_value:"hsinchu"},{area_name:"彰化縣",area_value:"changhua"},{area_name:"嘉義市",area_value:"chiayi"},{area_name:"高雄市",area_value:"kaohsiung"},{area_name:"宜蘭縣",area_value:"yilan"},{area_name:"台東縣",area_value:"taidong"},{area_name:"新北市",area_value:"newtaipei"},{area_name:"桃園市",area_value:"taoyuan"},{area_name:"台中市",area_value:"taichung"},{area_name:"南投縣",area_value:"nantou"},{area_name:"台南市",area_value:"tainan"},{area_name:"屏東縣",area_value:"pingtung"},{area_name:"花蓮縣",area_value:"hualien"},{area_name:"澎湖金門馬祖",area_value:"PenghuKinmenMatsu"}];function ue(){const s=te().state,[l,c]=o.useReducer(ie,I),[n,m]=o.useState([]),[_,E]=o.useState([]),[a,p]=o.useState(0),[v,Y]=o.useState([]),[H,B]=o.useState(!1),[K,C]=o.useState(!1),[U,W]=o.useState(!1),[z,J]=o.useState([]),[Q,D]=o.useState(!1),[q,g]=o.useState(null),j=o.useRef(null),V=async()=>{try{const t=await y.get(`${w}/gamesData`);p(Math.max(...t.data.map(i=>i.game_maxNum_Players)))}catch(t){const i=t.response.data.errors?"取得遊戲資料失敗":"";g(i)}},X=async()=>{try{const t=await y.get(`${w}/propertys_fixed_Data`);E(t.data)}catch(t){const i=t.response.data.errors?"取得標籤資料失敗":"";g(i)}},Z=async()=>{try{const t=await y.get(`${w}/difficultys_fixed_Data`);m(t.data)}catch(t){const i=t.response.data.errors?"取得難度資料失敗":"";g(i)}},ee=o.useCallback(()=>{B(t=>!t),j.current&&window.scrollTo({top:j.current.offsetTop-90,behavior:"smooth"})},[]),ae=o.useCallback(()=>{c({type:b.RESET}),C(!1),j.current&&window.scrollTo({top:j.current.offsetTop-90,behavior:"smooth"})},[]),se=t=>{const{value:i,name:u}=t.target;c(u==="area"||u==="difficulty"||u==="property"?{type:b.TOGGLE_ARRAY_FIELD,field:u,value:i}:{type:b.SET_FIELD,field:u,value:i})},T=o.useCallback(async t=>{t.preventDefault(),C(!0);const i=v.filter(({group:u,game:x})=>{const G=l.game_name===""?!0:u.game_name.includes(l.game_name),F=l.area.length===0?!0:l.area.some(N=>u.game_address.startsWith(N)),R=l.game_people===""?!0:u.group_member.includes(l.game_people),A=l.difficulty.length===0?!0:l.difficulty.includes(String(x.game_dif_tag)),L=l.property.length===0?!0:l.property.some(N=>String(x.game_main_tag1).includes(N)||String(x.game_main_tag2).includes(N));return G&&F&&R&&A&&L});W(i.length>0),J(i.sort((u,x)=>l.order==="order_price"?x.game_min_price-u.game_min_price:l.order==="order_popularity"?x.game_score_num-u.game_score_num:0)),j.current&&window.scrollTo({top:j.current.offsetTop-120,behavior:"smooth"})},[l,v]),re=async()=>{try{const[t,i,u]=await Promise.all([y.get(`${w}/groupsData`),y.get(`${w}/usersData`),y.get(`${w}/gamesData`)]),x=t.data,G=i.data,F=u.data;let R=0;const A=x.reduce((h,f)=>(new Date(f.group_active_date)>=new Date&&(h[R]=f,R++),h),[]),L=F.reduce((h,f)=>(h[f.game_id]=f,h),{}),N=G.reduce((h,f)=>(h[f.user_id]=f,h),{}),ce=A.map(h=>({group:h,game:L[h.game_id],user:N[h.user_id]}));Y(ce)}catch(t){const i=t.response.data.errors?"取得群組資料失敗":"";g(i)}},k=o.useCallback(async()=>{D(!0),g(null);try{await Promise.all([V(),X(),Z(),re()]),D(!1)}catch(t){const i=t.response.data.errors?"資料載入失敗，請重試":"";g(i),D(!1)}},[]),le=o.useCallback(async()=>{g(null),k()},[k]);return o.useEffect(()=>{k(),s&&s.gameName&&c({type:b.SET_FIELD,field:"game_name",value:s.gameName})},[k,s]),o.useEffect(()=>{s&&s.gameName&&v.length>0&&T({preventDefault:()=>{}})},[v,s,T]),e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"banner",children:e.jsxs("picture",{children:[e.jsx("source",{media:"(min-width: 992px)",srcSet:"./illustration/CTA-lg.png"}),e.jsx("img",{src:"./illustration/CTA.png",alt:"banner",className:"rounded mx-auto d-block"})]})}),e.jsx("div",{className:"my-md-10 my-sm-0",children:e.jsxs("div",{className:"container-lg",children:[e.jsx("div",{className:"row",children:e.jsx("div",{className:"col",children:e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body",children:[e.jsx("h5",{className:"card-title text-center",children:"揪團專區"}),e.jsxs("ol",{className:"card-text list-group list-group-numbered",children:[e.jsx("li",{className:"list-group-item",children:"發起揪團請至密室介紹頁點選揪團去開啟揪團吧"}),e.jsx("li",{className:"list-group-item",children:"請勿發表與密室逃脫無關之內容"}),e.jsx("li",{className:"list-group-item",children:"禁止一切交易買賣行為"}),e.jsx("li",{className:"list-group-item",children:"請勿暴雷"}),e.jsx("li",{className:"list-group-item",children:"禁止相同或類似之內容重複張貼洗版"})]})]})})})}),q&&e.jsx(O,{message:q,onRetry:le}),Q?e.jsx(ne,{message:"載入揪團列表中"}):e.jsxs("div",{className:"row flex-column flex-md-row g-0",children:[e.jsx(P,{search:l,handleInputChange:se,handleSearch:T,handleReset:ae,area:oe,difficultys:n,propertys:_,maxPeople:a}),e.jsx("div",{className:"col-md-9 p-0",ref:j,children:K?e.jsx(M,{searchGames:z,isHaveResultGames:U,group:v}):e.jsx(e.Fragment,{children:e.jsx($,{group:v,isAllRecommendDisplay:H,handleSeeRecommendMore:ee})})})]})]})})]})}export{ue as default};
