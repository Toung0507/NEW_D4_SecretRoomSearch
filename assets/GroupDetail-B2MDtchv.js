import{r as o,d as q,c as z,a as H,j as e,e as J,b as g,p as j}from"./index-ClSJhwQF.js";import{G as K}from"./GroupCard-BzlShs6V.js";import{T as O}from"./Toast-yiv-wyuv.js";const _="https://new-json.onrender.com";function X(){var G;const[s,w]=o.useState(null),[m,B]=o.useState(null),[x,$]=o.useState([]),[b,S]=o.useState(null),[k,L]=o.useState([]),[E,n]=o.useState(!0),{group_id:u}=q(),{user:i,user_token:f}=z(a=>a.userInfo),y=H();o.useEffect(()=>{(async()=>{n(!0);try{const r=await g.get(`${_}/groupsData/${u}`);w(r.data),n(!1)}catch(r){console.log(r.response.data.errors[0])}finally{n(!1)}})()},[u]),o.useEffect(()=>{(async()=>{n(!0);try{const r=await g.get(`${_}/groupsData`);L(r.data)}catch(r){console.log(r.response.data.errors[0])}finally{n(!1)}})()},[]);const v=async()=>{if(!i||!f){y(j({text:"請先登入",status:"failed"}));return}if(!s){y(j({text:"群組資料讀取中，請稍後再試",status:"success"}));return}if(s.group_participants&&s.group_participants.map(String).includes(String(i.user_id))){y(j({text:"您已加入此團!",status:"failed"}));return}try{const a=s.group_participants&&Array.isArray(s.group_participants)?[...s.group_participants,i.user_id]:[i.user_id];await g.patch(`${_}/groupsData/${u}`,{group_participants:a}),await P(),y(j({text:"報名完成",status:"success"}))}catch(a){console.log(a.response.data.errors[0]),y(j({text:"報名失敗，請稍後再試",status:"failed"}))}},P=async()=>{n(!0);try{const a=await g.get(`${_}/groupsData/${u}`);w(a.data)}catch(a){console.log(a.response.data.errors[0])}finally{n(!1)}},A=async()=>{n(!0);try{const a=await g.get(`${_}/gamesData`);B(a.data)}catch(a){console.log(a.response.data.errors[0])}finally{n(!1)}},F=async()=>{n(!0);try{const a=await g.get(`${_}/usersData`);$(a.data)}catch(a){console.log(a.response.data.errors[0])}finally{n(!1)}},C=async()=>{n(!0);try{const a=await g.get(`${_}/pricesData`);S(a.data)}catch(a){console.log(a.response.data.errors[0])}finally{n(!1)}};if(o.useEffect(()=>{A(),F(),C()},[u]),E)return e.jsx(J,{message:"載入相關資料中"});const t=m==null?void 0:m.find(a=>a.game_id===(s==null?void 0:s.game_id)),l=x==null?void 0:x.find(a=>a.user_id===(s==null?void 0:s.user_id)),p=b==null?void 0:b.filter(a=>a.game_id===(s==null?void 0:s.game_id));return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-nature-95",children:e.jsx("div",{className:"container-fluid container-lg",children:e.jsx("div",{className:"row justify-content-center",children:e.jsxs("div",{className:"col-xl-10 mt-9 mb-20",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("h2",{className:"fs-h5 fs-lg-h2 fw-bold",children:[`${s==null?void 0:s.group_active_date}`,(G=s==null?void 0:s.game_address)==null?void 0:G.slice(0,3),`${s==null?void 0:s.game_name}`]})}),e.jsxs("div",{children:[e.jsx("div",{className:"border-nature-90 border-top border-right border-left",children:e.jsxs("picture",{className:"ratio ratio-16x9",children:[e.jsx("source",{media:"(min-width: 992px)",alt:"banner",src:t==null?void 0:t.game_img[0],className:"rounded-4"}),e.jsx("img",{src:t==null?void 0:t.game_img[0],alt:"banner",className:"w-100 img-fluid rounded-top",style:{objectFit:"cover"}})]})}),e.jsxs("div",{className:"border border-nature-90 rounded-2 rounded-lg-4 bg-white",children:[e.jsxs("div",{className:"d-flex mt-4 mb-5 mx-lg-6 mx-4 align-items-center",children:[e.jsx("img",{src:(l==null?void 0:l.user_sex)==="男"?"./icon/man.png":(l==null?void 0:l.user_sex)==="女"?"./icon/woman.png":"./icon/user.png",alt:l==null?void 0:l.user_name,className:"rounded-circle me-3",style:{width:"5%",objectFit:"cover",aspectRatio:"1/1"}}),e.jsx("p",{className:"col-6 my-1 text-primary-black fs-Body-1 fw-bold lh-base",children:l==null?void 0:l.user_name})]}),e.jsxs("div",{className:"px-lg-6 px-4 py-5 border-bottom border-nature-90",children:[e.jsxs("div",{className:"row gy-4 custom-bdb",children:[e.jsxs("div",{className:"col-lg-4 py-4",children:[e.jsx("p",{className:"text-primary-50 fs-Body-2 mb-2",children:"密室名稱"}),e.jsx("p",{children:s==null?void 0:s.game_name})]}),e.jsxs("div",{className:"col-lg-4 py-4",children:[e.jsx("p",{className:"text-primary-50 fs-Body-2 mb-2",children:"揪團截止日期"}),e.jsx("p",{children:s==null?void 0:s.group_end_at})]}),e.jsxs("div",{className:"col-lg-4 py-4",children:[e.jsx("p",{className:"text-primary-50 fs-Body-2 mb-2",children:"活動日期"}),e.jsx("p",{children:s==null?void 0:s.group_active_date})]})]}),e.jsx("div",{className:"row gy-4 custom-bdb",children:e.jsxs("div",{className:"col py-4",children:[e.jsx("p",{className:"text-primary-50 fs-Body-2 mb-2",children:"密室地址"}),e.jsx("p",{children:s==null?void 0:s.game_address})]})}),e.jsxs("div",{className:"row gy-4 custom-bdb",children:[e.jsxs("div",{className:"col-6 col-lg-2 py-4",children:[e.jsx("p",{className:"text-primary-50 fs-Body-2 mb-2",children:"需求人數"}),e.jsxs("p",{children:[s==null?void 0:s.group_member,"人"]})]}),e.jsxs("div",{className:"col-6 col-lg-10 py-4",children:[e.jsx("p",{className:"text-primary-50 fs-Body-2 mb-2",children:"價格"}),e.jsx("ul",{children:(p==null?void 0:p.length)===2?e.jsx("li",{className:"fs-Body-2",children:(()=>{const a=p.find(h=>h.price_day_type==="weekday"),r=p.find(h=>h.price_day_type==="weekend");return e.jsxs(e.Fragment,{children:[a&&e.jsxs("span",{children:["平日 ",a.price_people,"：$",a.price_mix]}),e.jsx("br",{}),r&&e.jsxs("span",{children:["假日 ",r.price_people,"：$",r.price_mix]})]})})()}):p==null?void 0:p.map(a=>e.jsxs("li",{className:"fs-Body-2",children:[a.price_people,"：$",a.price_mix]},a.price_id))})]})]}),e.jsxs("div",{className:"row gy-4 custom-bdb",children:[e.jsxs("div",{className:"col-6 col-lg-2 py-4",children:[e.jsx("p",{className:"text-primary-50 fs-Body-2 mb-2",children:"是否歡迎新手"}),e.jsx("p",{children:s!=null&&s.group_noob?"是":"否"})]}),e.jsxs("div",{className:"col-6 col-lg-10 py-4",children:[e.jsx("p",{className:"text-primary-50 fs-Body-2 mb-2",children:"聯絡方式"}),e.jsx("p",{children:s==null?void 0:s.group_channel})]})]}),e.jsx("div",{className:"row gy-4 custom-bdb",children:e.jsxs("div",{className:"col py-4",children:[e.jsx("p",{className:"text-primary-50 fs-Body-2 mb-2",children:"揪團理念"}),e.jsx("p",{children:s==null?void 0:s.group_philosophy})]})}),e.jsx("div",{className:"row gy-4 custom-bdb",children:e.jsxs("div",{className:"col py-4",children:[e.jsx("p",{className:"text-primary-50 fs-Body-2 mb-2",children:"報名者"}),e.jsx("p",{children:s!=null&&s.group_participants&&(s==null?void 0:s.group_participants.length)>0?s==null?void 0:s.group_participants.map((a,r)=>{const h=x.find(D=>D.user_id===a);return e.jsxs("span",{children:[h?h.user_name:a,r!==s.group_participants.length-1&&", "]},a)}):"尚無參與者"}),e.jsxs("p",{className:"text-primary-50 fs-Body-2",children:["共",s==null?void 0:s.group_participants.length,"人加入此揪團"]})]})}),e.jsx("div",{className:"pt-5",children:e.jsxs("div",{className:"tags d-flex fs-Body-2 gap-2 mt-3",children:[e.jsx("span",{className:" bg-nature-95 px-1 py-1 rounded-3  text-nowrap",children:t==null?void 0:t.game_dif_tagname}),e.jsx("span",{className:" bg-nature-95 px-1 py-1 rounded-3 text-nowrap",children:t==null?void 0:t.game_main_tag1name}),e.jsx("span",{className:" bg-nature-95 px-1 py-1 rounded-3  text-nowrap",children:t==null?void 0:t.game_main_tag2name})]})})]}),e.jsx("div",{className:"my-5 mx-lg-6 mx-4",children:!i||!f?e.jsx("span",{className:"d-inline-block",tabIndex:"0","data-bs-toggle":"tooltip","data-bs-placement":"right",title:"請先登入",children:e.jsx("div",{className:"d-grid gap-2 col mx-auto d-lg-block",children:e.jsx("button",{type:"button",className:"btn btn-secondary-60 text-white",onClick:v,disabled:!i||!f||(i==null?void 0:i.user_role)==="店家",children:"我要參加"})})}):e.jsx("div",{className:"d-grid gap-2 col mx-auto d-lg-block",children:e.jsx("button",{type:"button",className:"btn btn-secondary-60 text-white",onClick:v,disabled:!i||!f||(i==null?void 0:i.user_role)==="店家",children:"我要參加"})})})]})]}),e.jsxs("div",{className:"row m-0 mt-7 mt-lg-6",children:[e.jsx("div",{className:"title-container w-100 d-flex justify-content-center align-items-center",children:e.jsx("h3",{className:"text-center mb-12 recommendation-title fw-bold fs-lg-h3 fs-h6",children:"相關推薦"})}),(()=>{const a=m==null?void 0:m.find(c=>c.game_id===(s==null?void 0:s.game_id));if(!a)return null;const r=new Date(s==null?void 0:s.group_active_date);return new Date>r?null:k.filter(c=>{if(String(c.group_id)===String(u))return!1;const N=new Date(c.group_active_date);if(new Date>N)return!1;const d=m.find(T=>T.game_id===c.game_id);if(!d)return!1;const M=d.game_dif_tagname&&a.game_dif_tagname&&d.game_dif_tagname===a.game_dif_tagname,R=d.game_main_tag1name&&a.game_main_tag1name&&d.game_main_tag1name===a.game_main_tag1name,U=d.game_main_tag2name&&a.game_main_tag2name&&d.game_main_tag2name===a.game_main_tag2name;return M||R||U}).slice(0,4).map(c=>{const N=m.find(d=>d.game_id===c.game_id);return c.user=x==null?void 0:x.find(d=>d.user_id===(c==null?void 0:c.user_id)),e.jsx(K,{game:N,group:c,user:c.user||{}},c.group_id)})})()]})]})})})}),e.jsx(O,{})]})}export{X as default};
