import{j as e,L as ce,P as d,r as l,e as te,b as k}from"./index-ClSJhwQF.js";function x({game:c}){return e.jsx("div",{className:"col-lg-3 col-md-4 col-sm-6 col2 ",children:e.jsx(ce,{to:`/Game_content/${c.game_id}`,children:e.jsxs("div",{className:"card card-recommend p-3 rounded-6 ",children:[e.jsxs("div",{className:"row g-0 align-items-start h-100",children:[e.jsx("div",{className:"col-auto col-sm-12 ratio ratio-16x9",children:e.jsx("img",{src:c.game_img[0],alt:c.game_name,className:"card-photo rounded-3 w-100 img-fluid"})}),e.jsx("div",{className:"col ms-3 ms-md-0",children:e.jsxs("div",{className:"card-body p-0 mt-3",children:[e.jsx("h6",{className:"card-title mb-1 mb-md-2 text-primary-black fw-bold lh-base",children:c.game_name}),e.jsx("p",{className:"card-text text-nature-40 mb-3 fw-bold fs-Body-2",children:c.game_address.slice(0,3)}),e.jsxs("p",{className:"d-flex align-items-center mb-2",children:[e.jsxs("span",{className:"rating dotted pe-3 fs-Body-2",children:[e.jsx("img",{src:"./icon/star.png",alt:"star",className:"pe-1"}),c.game_score]}),e.jsxs("span",{className:"ps-2 fs-Body-2",children:[c.game_score_num,"人評論"]})]}),e.jsxs("p",{className:"d-flex align-items-start flex-md-row flex-column ",children:[e.jsxs("span",{className:"dotted pe-md-3 fs-Body-2 pb-2 pb-md-0",children:[e.jsx("img",{src:"./icon/person.png",alt:"star",className:"pe-1 fs-Body-2"}),c.game_minNum_Players,"-",c.game_maxNum_Players," 人"]}),e.jsxs("span",{className:"ps-md-2  fs-Body-2",children:[e.jsx("img",{src:"./icon/price.png",alt:"star",className:"pe-1"}),"每人 ",c.game_min_price,"元起"]})]})]})})]}),e.jsxs("div",{className:"tags d-flex flex-wrap fs-Body-2 gap-2 mt-3 ",children:[e.jsx("span",{className:" bg-nature-95 px-2 py-1 rounded-3  text-nowrap",children:c.game_dif_tagname}),e.jsx("span",{className:" bg-nature-95 px-2 py-1 rounded-3 text-nowrap",children:c.game_main_tag1name}),e.jsx("span",{className:" bg-nature-95 px-2 py-1 rounded-3  text-nowrap",children:c.game_main_tag2name})]})]})})})}x.propTypes={game:d.shape({game_id:d.number.isRequired,game_img:d.array.isRequired,game_name:d.string.isRequired,game_address:d.string.isRequired,game_score:d.number.isRequired,game_score_num:d.number.isRequired,game_minNum_Players:d.number.isRequired,game_maxNum_Players:d.number.isRequired,game_min_price:d.number.isRequired,game_dif_tagname:d.string.isRequired,game_main_tag1name:d.string.isRequired,game_main_tag2name:d.string.isRequired}).isRequired};const S="https://new-json.onrender.com",j=[{area_name:"台北市",area_value:"taipei"},{area_name:"基隆市",area_value:"keelung"},{area_name:"新竹市",area_value:"hsinchu"},{area_name:"彰化縣",area_value:"changhua"},{area_name:"嘉義市",area_value:"chiayi"},{area_name:"高雄市",area_value:"kaohsiung"},{area_name:"宜蘭縣",area_value:"yilan"},{area_name:"台東縣",area_value:"taidong"},{area_name:"新北市",area_value:"newtaipei"},{area_name:"桃園市",area_value:"taoyuan"},{area_name:"台中市",area_value:"taichung"},{area_name:"南投縣",area_value:"nantou"},{area_name:"台南市",area_value:"tainan"},{area_name:"屏東縣",area_value:"pingtung"},{area_name:"花蓮縣",area_value:"hualien"},{area_name:"澎湖金門馬祖",area_value:"PenghuKinmenMatsu"}],M={order:"order_price",game_name:"",area:[],game_people:"",difficulty:[],property:[]};function me(){const[c,$]=l.useState([]),[u,H]=l.useState([]),[p,L]=l.useState([]),[R,V]=l.useState(0),[K,O]=l.useState(0),[s,b]=l.useState(M),[_,C]=l.useState(!1),[g,D]=l.useState(!1),[U,P]=l.useState(!1),[W,G]=l.useState(!1),[q,z]=l.useState([]),[F,J]=l.useState([]),[Q,X]=l.useState([]),[I,Y]=l.useState(!1),[Z,N]=l.useState(!0),[B,T]=l.useState(!0),o=l.useRef(null),ee=async()=>{try{const r=(await k.get(`${S}/gamesData`)).data.filter(i=>i.game_isStock===!0);r.length===0&&T(!1),$(r);const n=[...r].sort((i,h)=>h.game_score-i.game_score);z(n);const t=[...r].sort((i,h)=>new Date(h.game_start_date)-new Date(i.game_start_date));J(t),V(Math.max(...r.map(i=>i.game_maxNum_Players))),O(Math.min(...r.map(i=>i.game_minNum_Players)))}catch(a){N(!1),T(!1),console.log(a.response.data.errors[0])}},ae=async()=>{try{const a=await k.get(`${S}/propertys_fixed_Data`);L(a.data)}catch(a){N(!1),console.log(a.response.data.errors[0])}},se=async()=>{try{const a=await k.get(`${S}/difficultys_fixed_Data`);H(a.data)}catch(a){N(!1),console.log(a.response.data.errors[0])}},A=()=>{C(!_),o.current&&window.scrollTo({top:o.current.offsetTop-120,behavior:"smooth"})},E=()=>{D(!g),o.current&&window.scrollTo({top:o.current.offsetTop-90,behavior:"smooth"})},re=()=>{b(M),P(!1),o.current&&window.scrollTo({top:o.current.offsetTop-120,behavior:"smooth"})},m=a=>{const{value:r,name:n}=a.target;n=="area"||n=="difficulty"||n=="property"?b(t=>({...t,[n]:t[n].includes(r)?t[n].filter(i=>i!==r):[...t[n],r]})):b({...s,[n]:r})},w=l.useCallback(async a=>{a!==void 0&&a.preventDefault(),P(!0);const r=c.filter(n=>{const t=s.game_name===""?!0:n.game_name.includes(s.game_name),i=s.area.length===0?!0:s.area.some(f=>n.game_address.startsWith(f)),h=s.game_people===""?!0:n.game_minNum_Players<=parseInt(s.game_people,10)&&n.game_maxNum_Players>=parseInt(s.game_people,10),y=s.difficulty.length===0?!0:s.difficulty.includes(String(n.game_dif_tag)),v=s.property.length===0?!0:s.property.some(f=>String(n.game_main_tag1).includes(f)||String(n.game_main_tag2).includes(f));return t&&i&&h&&y&&v});r.length===0?G(!1):r.length>0&&G(!0),X(r.sort((n,t)=>s.order==="order_price"?t.game_min_price-n.game_min_price:s.order==="order_popularity"?t.game_score_num-n.game_score_num:0)),o.current&&window.scrollTo({top:o.current.offsetTop-90,behavior:"smooth"})},[c,s.area,s.difficulty,s.game_name,s.game_people,s.order,s.property]);l.useEffect(()=>{ee(),ae(),se()},[]),l.useEffect(()=>{const a=window.location.hash,r=a.indexOf("?");if(r!==-1){const n=a.substring(r+1),t=new URLSearchParams(n),i=t.get("area"),h=t.get("num"),y=t.get("property"),v=t.get("difficulty");b(f=>({...f,area:i?[i]:[],game_people:h?Number(h):"",property:y?[String(y)]:[],difficulty:v?[String(v)]:[]})),Y(!0)}},[]);const le=l.useRef(null),ne=l.useRef(null);return l.useEffect(()=>{I&&c.length>0&&w()},[I,c,w]),l.useEffect(()=>{if(s.area.length>0){const a=window.location.hash;if(a.includes("?")){const r=a.split("?")[0];window.history.replaceState(null,"",r)}}},[s.area,s.num,s.property,s.difficulty]),l.useEffect(()=>{c.length>0&&u.length>0&&p.length>0&&(console.log(K),console.log(R),N(!1))},[c.length,u.length,p.length]),Z?e.jsx(te,{message:"遊戲資料載入中"}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"banner",children:[e.jsx("div",{className:"banner-title d-none",children:e.jsx("h1",{className:"",children:"找密室"})}),e.jsxs("picture",{children:[e.jsx("source",{media:"(min-width: 992px)",srcSet:"./illustration/Banner.png"}),e.jsx("img",{src:"./illustration/Banner-2.svg",alt:"banner",className:"w-100"})]})]}),e.jsx("div",{className:"my-md-10 my-sm-0",children:e.jsx("div",{className:"container-lg",children:e.jsxs("div",{className:"row flex-column flex-md-row g-0",children:[e.jsxs("div",{className:"col-md-3 pe-lg-6 pe-md-3 ",children:[e.jsxs("form",{className:"p-4 bg-white",onSubmit:a=>w(a),ref:le,children:[e.jsxs("div",{className:"order",children:[e.jsx("p",{className:"h5 pb-3  fw-bold",children:"排序條件"}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"form-check form-check-inline ",children:[e.jsx("input",{onChange:m,className:"form-check-input",defaultChecked:!0,type:"radio",name:"order",id:"order_price",value:"order_price"}),e.jsx("label",{className:"form-check-label",htmlFor:"order_price",children:"價格(由高到低)"})]}),e.jsxs("div",{className:"form-check form-check-inline",children:[e.jsx("input",{onChange:m,className:"form-check-input",type:"radio",name:"order",id:"order_popularity",value:"order_popularity"}),e.jsx("label",{className:"form-check-label",htmlFor:"order_popularity",children:"人氣"})]})]})]}),e.jsxs("div",{className:"search",children:[e.jsx("p",{className:"h5 pb-3  fw-bold",children:"遊戲名稱"}),e.jsxs("div",{className:"search-all-group mb-6",children:[e.jsx("label",{htmlFor:"",className:"pb-1",children:"搜尋"}),e.jsx("div",{className:" input-group search-group border  rounded-1  border-primary-black",children:e.jsx("input",{onChange:m,type:"text",className:"form-control border-0 search-input",placeholder:"搜尋關鍵字","aria-label":"Search",name:"game_name",value:s.game_name})})]})]}),e.jsx("div",{className:"d-flex  w-100  ",children:e.jsxs("div",{className:"row w-100 row1 flex-md-column",children:[e.jsx("div",{className:"col-6 col-md-12 col1 ",children:e.jsxs("div",{className:"area",children:[e.jsx("p",{className:"h5 pb-4  fw-bold",children:"遊戲地區"}),e.jsxs("select",{onChange:m,className:"form-select d-md-none mb-md-6 mb-3 border  rounded-1  border-primary-black","aria-label":"Default select example",name:"area",value:s.area.length>0?s.area[0]:"",children:[e.jsx("option",{defaultValue:!0,children:"請選擇遊玩地區"}),j.map((a,r)=>e.jsx("option",{value:a.area_name,children:a.area_name},r))]}),e.jsxs("div",{className:"row m-0 mb-6 d-none d-md-flex",children:[e.jsx("div",{className:"col-md-6 mx-0 p-0 w-auto",children:j.slice(0,j.length/2).map((a,r)=>e.jsxs("div",{className:"form-check mb-4 me-6",children:[e.jsx("input",{onChange:m,className:"form-check-input ",type:"checkbox",value:a.area_name,id:a.area_value,name:"area",checked:s.area.includes(a.area_name)}),e.jsx("label",{className:"form-check-label text-nowrap",htmlFor:a.area_value,children:a.area_name})]},r))}),e.jsx("div",{className:"col-md-6 m-0 p-0",children:j.slice(j.length/2).map((a,r)=>e.jsxs("div",{className:"form-check mb-4 ",children:[e.jsx("input",{onChange:m,className:"form-check-input",type:"checkbox",value:a.area_name,id:a.area_value,name:"area",checked:s.area.includes(a.area_name)}),e.jsx("label",{className:"form-check-label text-nowrap",htmlFor:a.area_value,children:a.area_name})]},r))})]})]})}),e.jsx("div",{className:"col-6 col-md-12 col1 ",children:e.jsxs("div",{className:"people",children:[e.jsx("p",{className:"h5 pb-4  fw-bold",children:"遊玩人數"}),e.jsxs("select",{onChange:m,className:"form-select mb-md-6 mb-3 border  rounded-1  border-primary-black","aria-label":"Default select example",name:"game_people",value:s.game_people,children:[e.jsx("option",{defaultValue:!0,children:"請選擇遊玩人數"}),Array.from({length:Number(R)}).map((a,r)=>e.jsxs("option",{value:r+1,children:[r+1,"人"]},r))]})]})})]})}),e.jsx("div",{className:"d-flex  w-100  ",children:e.jsxs("div",{className:"row w-100 row1 flex-md-column",children:[e.jsx("div",{className:"col-6 col-md-12 col1 ",children:e.jsxs("div",{className:"difficulty",children:[e.jsx("p",{className:"h5 pb-4  fw-bold",children:"難度"}),e.jsxs("select",{onChange:m,className:"form-select d-md-none mb-md-6 mb-3 border  rounded-1  border-primary-black","aria-label":"Default select example",name:"difficulty",value:s.difficulty.length>0?s.difficulty[0]:"",children:[e.jsx("option",{defaultValue:!0,children:"請選擇難度"}),u.map(a=>e.jsx("option",{value:a.difficulty_id,children:a.difficulty_name},a.difficulty_id))]}),e.jsxs("div",{className:"row m-0 mb-6 d-none d-md-flex",children:[e.jsx("div",{className:"col-md-6 mx-0 p-0 w-auto",children:u.slice(0,Math.round(u.length/2)).map(a=>e.jsxs("div",{className:"form-check mb-4 me-6",children:[e.jsx("input",{onChange:m,className:"form-check-input",type:"checkbox",value:a.difficulty_id,id:a.difficulty_id,name:"difficulty",checked:s.difficulty.includes(String(a.difficulty_id))}),e.jsx("label",{className:"form-check-label text-nowrap",htmlFor:a.difficulty_id,children:a.difficulty_name})]},a.difficulty_id))}),e.jsx("div",{className:"col-md-6 m-0 p-0",children:u.slice(Math.round(u.length/2)).map(a=>e.jsxs("div",{className:"form-check mb-4 ",children:[e.jsx("input",{onChange:m,className:"form-check-input",type:"checkbox",value:a.difficulty_id,id:a.difficulty_id,name:"difficulty",checked:s.difficulty.includes(String(a.difficulty_id))}),e.jsx("label",{className:"form-check-label text-nowrap",htmlFor:a.difficulty_id,children:a.difficulty_name})]},a.difficulty_id))})]})]})}),e.jsx("div",{className:"col-6 col-md-12 col1 ",children:e.jsxs("div",{className:"topic",children:[e.jsx("p",{className:"h5 pb-4  fw-bold",children:"主題"}),e.jsxs("select",{onChange:m,className:"form-select d-md-none mb-md-6 mb-3 border  rounded-1  border-primary-black","aria-label":"Default select example",name:"property",value:s.property.length>0?s.property[0]:"",children:[e.jsx("option",{defaultValue:!0,children:"請選擇主題類別"}),p.map(a=>e.jsx("option",{value:a.property_id,children:a.property_name},a.property_id))]}),e.jsxs("div",{className:"row m-0 mb-6 d-none d-md-flex",children:[e.jsx("div",{className:"col-md-6 mx-0 p-0 w-auto",children:p.slice(0,p.length/2).map(a=>e.jsxs("div",{className:"form-check mb-4 me-6",children:[e.jsx("input",{onChange:m,className:"form-check-input",type:"checkbox",value:a.property_id,id:a.property_name,name:"property",checked:s.property.includes(String(a.property_id))}),e.jsx("label",{className:"form-check-label text-nowrap",htmlFor:a.property_name,children:a.property_name})]},a.property_id))}),e.jsx("div",{className:"col-md-6 m-0 p-0",children:p.slice(p.length/2).map(a=>e.jsxs("div",{className:"form-check mb-4 ",children:[e.jsx("input",{onChange:m,className:"form-check-input",type:"checkbox",value:a.property_id,id:a.property_name,name:"property",checked:s.property.includes(String(a.property_id))}),e.jsx("label",{className:"form-check-label text-nowrap",htmlFor:a.property_name,children:a.property_name})]},a.property_id))})]})]})})]})}),e.jsx("div",{className:"text-center",children:e.jsx("button",{className:"btn btn-secondary-60 link-white rounded-2 w-100",id:"userSumbit",ref:ne,disabled:!B,children:"搜尋"})})]}),e.jsx("div",{className:" px-4",children:e.jsx("button",{onClick:re,className:"btn w-100 reset_button border-0  text-sm-center text-end",children:"重置"})})]}),e.jsx("div",{className:"col-md-9 p-0",ref:o,children:U?e.jsx("div",{className:"search my-5 my-md-10 ",children:e.jsx("div",{className:"row m-0",children:e.jsx("div",{className:"row m-0",children:W?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"title-container w-100  d-flex justify-content-center align-items-center",children:e.jsx("h3",{className:"text-center mb-12 recommendation-title fw-bold fs-sm-h3 fs-h6",children:"依據您的搜尋/排序結果如下"})}),Q.map(a=>e.jsx(x,{game:a},a.game_id))]}):e.jsx("div",{className:"text-center",children:e.jsxs("p",{className:"h4",children:["您輸入的條件未查詢到相符合結果",e.jsx("br",{}),"請放寬條件重新查詢"]})})})})}):e.jsx(e.Fragment,{children:B?e.jsxs(e.Fragment,{children:[!g&&e.jsxs("div",{className:"recommend ",children:[e.jsx("div",{className:"title-container w-100 d-flex justify-content-center align-items-center",children:e.jsx("h3",{className:"text-center mb-12 recommendation-title fw-bold fs-sm-h3 fs-h6",children:"本月推薦"})}),e.jsxs("div",{className:"row m-0",children:[_?q.map(a=>e.jsx(x,{game:a},a.game_id)):q.slice(0,8).map(a=>e.jsx(x,{game:a},a.game_id)),e.jsxs("div",{className:"d-flex justify-content-end mt-3 mt-md-0 p-0",children:[e.jsx("button",{className:`btn btn-secondary-60 text-white  ${_?"d-none":""}`,onClick:()=>A(),children:"查看更多推薦"}),e.jsx("button",{className:`btn btn-secondary-60 text-white  ${_?"":"d-none"}`,onClick:()=>A(),children:"顯示較少，返回查看新作"})]})]})]}),!_&&e.jsxs("div",{className:"recently my-5 my-md-10 ",children:[e.jsx("div",{className:"title-container w-100  d-flex justify-content-center align-items-center",children:e.jsx("h3",{className:"text-center mb-12 recommendation-title fw-bold fs-sm-h3 fs-h6",children:"近期新作"})}),e.jsx("div",{className:"row m-0",children:e.jsxs("div",{className:"row m-0",children:[g?F.map(a=>e.jsx(x,{game:a},a.game_id)):F.slice(0,8).map(a=>e.jsx(x,{game:a},a.game_id)),e.jsxs("div",{className:"d-flex justify-content-end mt-3 mt-md-0 p-0",children:[e.jsx("button",{className:`btn btn-secondary-60 text-white   ${g?"d-none":""}`,onClick:()=>E(),children:"查看更多新作"}),e.jsx("button",{className:`btn btn-secondary-60 text-white   ${g?"":"d-none"}`,onClick:()=>E(),children:"顯示較少，返回查看推薦"})]})]})})]})]}):e.jsx(e.Fragment,{children:e.jsx("div",{className:"recently my-5 my-md-10 ",children:e.jsx("div",{className:"title-container w-100  d-flex justify-content-center align-items-center",children:e.jsx("h3",{className:"text-center mb-12 recommendation-title fw-bold fs-sm-h3 fs-h6",children:"尚無任何遊戲資料，無法搜尋"})})})})})})]})})})]})}export{me as default};
